<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>点滅・計算・認証・条文・署名システム</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #blinkingText { font-size: 24px; font-weight: bold; color: blue; min-height: 1.5em; }
    .section { display: none; margin-top: 20px; }
    .calc-box, .auth-box, .terms-box, .sign-box {
      margin-top: 20px; padding: 15px;
      border: 1px solid #aaa; border-radius: 8px; background: #f8f8f8;
    }
    label { display: block; margin-top: 10px; }
    .result { font-size: 20px; font-weight: bold; margin-top: 10px; }
    button {
      margin-top: 15px; padding: 8px 18px; font-size: 16px;
      border-radius: 6px; border: 1px solid #444;
    }
  </style>
</head>

<body>

<!-- ========= ① 初期画面 ========= -->
<div id="page1" class="section" style="display:block;">
  <h2>点滅テキストとスライダー</h2>

  <label>表示する文字:</label>
  <input type="text" id="textInput" value="点滅する文字">

  <label>点滅間隔: <span id="intervalValue">500</span> ms</label>
  <input type="range" id="intervalSlider" min="100" max="2000" value="500">

  <p id="blinkingText"></p>

  <div class="calc-box">
    <h3>B - O × T = S</h3>
    <label>B:</label><input type="number" id="B" value="100">
    <label>O:</label><input type="number" id="O" value="2">
    <label>T:</label><input type="number" id="T" value="10">
    <div class="result">S = <span id="S">0</span></div>
    <button id="goAuth">暗証番号として使用</button>
  </div>
</div>

<!-- ========= ② 認証画面 ========= -->
<div id="page2" class="section auth-box">
  <h3>暗証番号認証</h3>
  <label>暗証番号:</label>
  <input type="number" id="authInput">
  <button id="authBtn">認証する</button>
  <p id="authMsg" style="color:red;"></p>
</div>

<!-- ========= ③ 条文 ========= -->
<div id="page3" class="section terms-box">
  <h3>取引条文</h3>
  <ol>
    <li>交換を承諾すること</li>
    <li>取引目的を理解すること</li>
    <li>仲介者は融資しない</li>
    <li>オプションを活用する</li>
    <li>合意後、署名へ進む</li>
  </ol>
  <button id="goSign">署名へ</button>
</div>

<!-- ========= ④ 署名 ========= -->
<div id="page4" class="section sign-box">
  <h3>署名</h3>
  <input type="text" id="signInput">
  <button id="finishBtn">確認</button>
</div>

<!-- ========= JavaScript（本体） ========= -->
<script>
/* --- 点滅 --- */
const textInput = document.getElementById("textInput");
const slider = document.getElementById("intervalSlider");
const intervalValue = document.getElementById("intervalValue");
const blinkingText = document.getElementById("blinkingText");

let timer;
function startBlink(ms) {
  clearInterval(timer);
  timer = setInterval(() => {
    blinkingText.style.visibility =
      blinkingText.style.visibility === "hidden" ? "visible" : "hidden";
  }, ms);
}

textInput.oninput = () => blinkingText.textContent = textInput.value;
slider.oninput = () => {
  intervalValue.textContent = slider.value;
  startBlink(slider.value);
};

blinkingText.textContent = textInput.value;
startBlink(slider.value);

/* --- 計算 --- */
const B = document.getElementById("B");
const O = document.getElementById("O");
const T = document.getElementById("T");
const S = document.getElementById("S");

function calc() {
  S.textContent = Math.floor((+B.value || 0) - (+O.value || 0) * (+T.value || 0));
}
[B, O, T].forEach(el => el.oninput = calc);
calc();

/* --- 画面切替 --- */
function show(id) {
  document.querySelectorAll(".section").forEach(s => s.style.display = "none");
  document.getElementById(id).style.display = "block";
}

document.getElementById("goAuth").onclick = () => show("page2");

document.getElementById("authBtn").onclick = () => {
  if (+authInput.value === +S.textContent) {
    authMsg.textContent = "";
    show("page3");
  } else {
    authMsg.textContent = "暗証番号が違います";
  }
};

document.getElementById("goSign").onclick = () => show("page4");

document.getElementById("finishBtn").onclick = () => {
  alert("署名確認。最初に戻ります。");
  signInput.value = "";
  show("page1");
};
</script>

</body>
</html>
